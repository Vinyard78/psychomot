<!DOCTYPE html>
<html>
	<head>

	</head>
	<body>
		<canvas id="canvas">
		    <p>Désolé, votre navigateur ne supporte pas Canvas. Mettez-vous à jour</p>
		</canvas>
		<script>
			var canvas  = document.querySelector('#canvas');
			canvas.width = 1000;
			canvas.height = 1000;
			var context = canvas.getContext('2d');

			function Examen(nom, resultat, moyenne, ecartType, max) {
				this.nom = nom;
				this.resultat = resultat;
				this.moyenne = moyenne;
				this.ecartType = ecartType;
				this.max = max;

				this.coordResultat = { x : 0, y : 0};
				this.coordMoyMax = { x : 0, y : 0};
				this.coordMoyMin = { x : 0, y : 0};
				this.coordMoy = { x : 0, y : 0};

			}

			var data = [
				new Examen("test1",36,36,3,50),
				new Examen("test2",22,39,4,60),
				new Examen("test3",17,15,2,45),
				new Examen("test4",40,30,1,70),
				new Examen("test5",36,35,3,84),
				new Examen("test6",15,32,5,50),
				new Examen("test6",15,32,5,50)
			];

			// Point qui se situe au milieu du canvas
			var middlePoint = {
				x : canvas.width/2,
				y : canvas.height/2
			};

			const FACTOR = 250;

			var start = {
				x : middlePoint.x, 
				y : middlePoint.y - FACTOR
			};

			/** 
			 * Fonction qui permet de donner les coordonnées d'un point suivant un angle donné sur le cercle trigonométrique 
			 * par rapport à un point de départ situé en haut du cercle trigo (rotation positive vers la gauche).
			 * 
			 * x et y sont les coordonnées du point de départ
			 * value est l'angle (ex: Math.PI/4)
			 * factor est le facteur d'agrandissement
			 */
			function convert(value, x, y, factor) {

				x = typeof(x) === "number" ? x : 0;
				y = typeof(y) === "number" ? y : 0;
				factor = typeof(factor) === "number" ? factor : 1;
				value = typeof(value) === "number" ? value : 0;

				var result = {
					x : x - factor * (Math.sin(value)),
					y : y + factor * (1 - Math.cos(value))
				};

				return result;
			}	

			function pythagore(x1,y1,x2,y2){
				x1 = typeof(x1) === "number" ? x1 : 0;
				y1 = typeof(y1) === "number" ? y1 : 0;
				x2 = typeof(x2) === "number" ? x2 : 0;
				y2 = typeof(y2) === "number" ? y2 : 0;

				return Math.sqrt(Math.pow(y2-y1,2)+Math.pow(x2-x1,2));
			}






			













			context.fillStyle = "rgba(23, 145, 167, 0.5)";
			context.beginPath();

			// Point de départ du tracé
			context.moveTo(start.x, start.y);
			data[0].coordMoyMax.x = start.x;
			data[0].coordMoyMax.y = start.y;


			for(var i = 1, length = data.length; i < length; i++ ){
				var value = convert(i * 2 * Math.PI / data.length, start.x, start.y, FACTOR);
				data[i].coordMoyMax.y = value.y;
				data[i].coordMoyMax.x = value.x;
				context.lineTo(value.x,value.y);
			}

			context.closePath();
			context.fill();






			
			start.x = data[0].coordMoyMax.x;
			start.y = data[0].coordMoyMax.y + (((middlePoint.y - data[0].coordMoyMax.y) / (data[0].moyenne + data[0].ecartType)) * (data[0].ecartType * 2));

			context.fillStyle = "rgba(255, 255, 255, 1)";

			context.beginPath();

			// Point de départ du tracé
			context.moveTo(start.x, start.y);

			data[0].coordMoyMin.x = start.x;
			data[0].coordMoyMin.y = start.y;

			for(var i = 1, length = data.length; i < length; i++ ){

				var rayon = pythagore(middlePoint.x,middlePoint.y,data[i].coordMoyMax.x,data[i].coordMoyMax.y);
				var moyMax = data[i].moyenne + data[i].ecartType;
				var norm = rayon / moyMax;
				var longueurBandeMoy = norm * data[i].ecartType * 2;

				data[i].coordMoyMin.x = data[i].coordMoyMax.x + (middlePoint.x - data[i].coordMoyMax.x) * longueurBandeMoy / rayon;
				data[i].coordMoyMin.y = data[i].coordMoyMax.y + (middlePoint.y - data[i].coordMoyMax.y) * longueurBandeMoy / rayon;

				context.lineTo(data[i].coordMoyMin.x,data[i].coordMoyMin.y);
			}

			context.closePath();
			context.fill();







			start.x = data[0].coordMoyMax.x;
			start.y = data[0].coordMoyMax.y + (((middlePoint.y - data[0].coordMoyMax.y) / (data[0].moyenne + data[0].ecartType)) * (data[0].ecartType));

			context.lineWidth="2";
			context.strokeStyle = "rgba(0, 0, 0, 1)";

			context.beginPath();

			// Point de départ du tracé
			context.moveTo(start.x, start.y);
			
			data[0].coordMoy.x = start.x;
			data[0].coordMoy.y = start.y;

			for(var i = 1, length = data.length; i < length; i++ ){

				var rayon = pythagore(middlePoint.x,middlePoint.y,data[i].coordMoyMax.x,data[i].coordMoyMax.y);
				var moyMax = data[i].moyenne + data[i].ecartType;
				var norm = rayon / moyMax;
				var longueurBandeMoy = norm * data[i].ecartType;

				data[i].coordMoy.x = data[i].coordMoyMax.x + (middlePoint.x - data[i].coordMoyMax.x) * longueurBandeMoy / rayon;
				data[i].coordMoy.y = data[i].coordMoyMax.y + (middlePoint.y - data[i].coordMoyMax.y) * longueurBandeMoy / rayon;

				context.lineTo(data[i].coordMoy.x,data[i].coordMoy.y);
			}

			context.closePath();
			context.stroke();






			start.x = middlePoint.x;
			start.y = middlePoint.y - (((middlePoint.y - data[0].coordMoyMax.y) / (data[0].moyenne + data[0].ecartType)) * (data[0].resultat));

			//context.lineWidth="10";
			context.fillStyle = "rgba(255, 0, 0, .9)";

			context.beginPath();

			// Point de départ du tracé
			context.moveTo(start.x, start.y);
			
			data[0].coordResultat.x = start.x;
			data[0].coordResultat.y = start.y;

			for(var i = 1, length = data.length; i < length; i++ ){

				var rayon = pythagore(middlePoint.x,middlePoint.y,data[i].coordMoyMax.x,data[i].coordMoyMax.y);
				var moyMax = data[i].moyenne + data[i].ecartType;
				var norm = rayon / moyMax;
				var longueurDeltaRes = rayon - (norm * data[i].resultat);

				data[i].coordResultat.x = data[i].coordMoyMax.x + (middlePoint.x - data[i].coordMoyMax.x) * longueurDeltaRes / rayon;
				data[i].coordResultat.y = data[i].coordMoyMax.y + (middlePoint.y - data[i].coordMoyMax.y) * longueurDeltaRes / rayon;

				context.lineTo(data[i].coordResultat.x,data[i].coordResultat.y);
			}

			context.closePath();
			context.fill();












			var limit = [];
			var exces = 100;

			start.x = middlePoint.x;
			start.y = data[0].coordMoyMax.y - exces;

			//context.lineWidth="10";
			context.strokeStyle = "rgba(150, 150, 150, 1)";

			context.beginPath();

			// Point de départ du tracé
			context.moveTo(start.x, start.y);

			context.lineTo(middlePoint.x,middlePoint.y);

			for(var i = 1, length = data.length; i < length; i++ ){

				var rayon = pythagore(middlePoint.x,middlePoint.y,data[i].coordMoyMax.x,data[i].coordMoyMax.y);
				var moyMax = data[i].moyenne + data[i].ecartType;
				var norm = rayon / moyMax;
				var longueurDeltaRes = -exces;

				var X = data[i].coordMoyMax.x + (middlePoint.x - data[i].coordMoyMax.x) * longueurDeltaRes / rayon;
				var Y = data[i].coordMoyMax.y + (middlePoint.y - data[i].coordMoyMax.y) * longueurDeltaRes / rayon;

				context.moveTo(X,Y);
				context.lineTo(middlePoint.x,middlePoint.y);
			}

			context.closePath();
			context.stroke();









		</script>
	</body>
</html>